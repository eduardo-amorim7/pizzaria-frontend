<!DOCTYPE html>
<html lang="pt-BR" ng-app="pizzariaApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDS - Kitchen Display System</title>
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/kds-style.css" rel="stylesheet">
</head>
<body class="kds-layout" ng-controller="KdsController">

    <!-- Header do KDS -->
    <div class="kds-header">
        <div class="kds-header-left">
            <button class="menu-btn">
                <i class="fas fa-bars"></i>
            </button>
            <button class="tab">
                Pedidos <i class="fas fa-times" style="margin-left: 8px;"></i>
            </button>
        </div>
        
        <div class="kds-header-center">
            <button class="filter-btn" ng-class="{'active': filtros.tipo === 'entrega'}" ng-click="toggleFiltro('tipo', 'entrega')">
                <i class="fas fa-motorcycle"></i>
                Entrega
            </button>
            <button class="filter-btn" ng-class="{'active': filtros.tipo === 'retirada'}" ng-click="toggleFiltro('tipo', 'retirada')">
                <i class="fas fa-walking"></i>
                Retirada
            </button>
            <button class="filter-btn" ng-class="{'active': filtros.tipo === 'consumo_local'}" ng-click="toggleFiltro('tipo', 'consumo_local')">
                <i class="fas fa-utensils"></i>
                Balcão
            </button>
            <button class="filter-btn" ng-class="{'active': filtros.tipo === 'mesa'}" ng-click="toggleFiltro('tipo', 'mesa')">
                <i class="fas fa-chair"></i>
                Mesa
            </button>
        </div>
        
        <div class="kds-header-right">
            <button class="action-btn btn-green">
                <i class="fas fa-globe"></i>
                Site Aberto
            </button>
            <button class="action-btn btn-red">
                <i class="fas fa-cash-register"></i>
                Caixa Aberto
            </button>
            <button class="action-btn btn-blue">
                <i class="fas fa-list-alt"></i>
                Caixa Detalhado
            </button>
            <button class="action-btn btn-dark" ng-click="novoPedido()">
                <i class="fas fa-plus"></i>
                Novo Pedido
            </button>
            <div class="time-display">
                <i class="fas fa-clock"></i>
                {{currentTime | date:'HH:mm'}}
            </div>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </div>

    <!-- Container principal do KDS -->
    <div class="kds-container">
        
        <!-- Coluna: Novos -->
        <div class="kds-column">
            <div class="kds-column-header">
                <span>
                    <i class="fas fa-bell"></i>
                    Novos
                </span>
                <span class="count-badge">{{getPedidosPorStatus('aguardando_preparo').length}}</span>
            </div>
            <div class="kds-column-content">
                <div class="kds-order-card status-novo" 
                     ng-repeat="pedido in getPedidosPorStatus('aguardando_preparo') track by pedido._id"
                     ng-class="{'urgent': isUrgent(pedido)}">
                    
                    <!-- Header do card -->
                    <div class="kds-card-header">
                        <div class="kds-order-number">{{pedido.numero}}</div>
                        <div class="kds-order-type" ng-class="pedido.tipo">
                            <i class="fas" ng-class="getTypeIcon(pedido.tipo)"></i>
                            {{pedido.tipo | tipoText}}
                        </div>
                    </div>
                    
                    <!-- Canal -->
                    <div class="mb-2">
                        <span class="kds-channel-badge" ng-class="pedido.canal">
                            {{pedido.canal | canalText}}
                        </span>
                    </div>
                    
                    <!-- Informações do cliente -->
                    <div class="kds-customer-info">
                        <div class="kds-customer-name">{{pedido.cliente.nome}}</div>
                        <div class="kds-customer-phone" ng-if="pedido.cliente.telefone">
                            <i class="fas fa-phone"></i> {{pedido.cliente.telefone}}
                        </div>
                        <div class="kds-customer-address" ng-if="pedido.tipo === 'entrega' && pedido.cliente.endereco">
                            <i class="fas fa-map-marker-alt"></i>
                            {{pedido.cliente.endereco.rua}}, {{pedido.cliente.endereco.numero}} - {{pedido.cliente.endereco.bairro}}
                        </div>
                    </div>
                    
                    <!-- Itens do pedido -->
                    <div class="kds-order-items">
                        <div class="kds-order-item" ng-repeat="item in pedido.itens">
                            <div class="kds-item-name">
                                {{item.quantidade}}x {{item.produto.nome || item.produto_nome}} ({{item.tamanho}})
                            </div>
                            <div class="kds-item-details" ng-if="item.sabores.length > 0">
                                {{item.sabores.join(', ')}}
                            </div>
                            <div class="kds-item-details" ng-if="item.observacoes">
                                <i class="fas fa-comment"></i> {{item.observacoes}}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer do card -->
                    <div class="kds-card-footer">
                        <div class="kds-time-info">
                            <span><i class="fas fa-clock"></i> {{formatarTempo(calcularTempoDecorrido(pedido))}}</span>
                            <span class="kds-time-elapsed">{{calcularTempoDecorrido(pedido)}}min</span>
                        </div>
                        <div class="kds-card-actions">
                            <button class="kds-action-btn btn-green" 
                                    ng-click="atualizarStatus(pedido, 'em_preparo')"
                                    title="Iniciar Preparo">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="kds-action-btn btn-red" 
                                    ng-click="cancelarPedido(pedido)"
                                    title="Cancelar">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coluna: Processando -->
        <div class="kds-column">
            <div class="kds-column-header">
                <span>
                    <i class="fas fa-fire"></i>
                    Processando
                </span>
                <span class="count-badge">{{getPedidosPorStatus('em_preparo').length}}</span>
            </div>
            <div class="kds-column-content">
                <div class="kds-order-card status-processando" 
                     ng-repeat="pedido in getPedidosPorStatus('em_preparo') track by pedido._id"
                     ng-class="{'urgent': isUrgent(pedido)}">
                    
                    <!-- Header do card -->
                    <div class="kds-card-header">
                        <div class="kds-order-number">{{pedido.numero}}</div>
                        <div class="kds-order-type" ng-class="pedido.tipo">
                            <i class="fas" ng-class="getTypeIcon(pedido.tipo)"></i>
                            {{pedido.tipo | tipoText}}
                        </div>
                    </div>
                    
                    <!-- Canal -->
                    <div class="mb-2">
                        <span class="kds-channel-badge" ng-class="pedido.canal">
                            {{pedido.canal | canalText}}
                        </span>
                    </div>
                    
                    <!-- Informações do cliente -->
                    <div class="kds-customer-info">
                        <div class="kds-customer-name">{{pedido.cliente.nome}}</div>
                        <div class="kds-customer-phone" ng-if="pedido.cliente.telefone">
                            <i class="fas fa-phone"></i> {{pedido.cliente.telefone}}
                        </div>
                        <div class="kds-customer-address" ng-if="pedido.tipo === 'entrega' && pedido.cliente.endereco">
                            <i class="fas fa-map-marker-alt"></i>
                            {{pedido.cliente.endereco.rua}}, {{pedido.cliente.endereco.numero}} - {{pedido.cliente.endereco.bairro}}
                        </div>
                    </div>
                    
                    <!-- Itens do pedido -->
                    <div class="kds-order-items">
                        <div class="kds-order-item" ng-repeat="item in pedido.itens">
                            <div class="kds-item-name">
                                {{item.quantidade}}x {{item.produto.nome || item.produto_nome}} ({{item.tamanho}})
                            </div>
                            <div class="kds-item-details" ng-if="item.sabores.length > 0">
                                {{item.sabores.join(', ')}}
                            </div>
                            <div class="kds-item-details" ng-if="item.observacoes">
                                <i class="fas fa-comment"></i> {{item.observacoes}}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer do card -->
                    <div class="kds-card-footer">
                        <div class="kds-time-info">
                            <span><i class="fas fa-clock"></i> {{formatarTempo(calcularTempoDecorrido(pedido))}}</span>
                            <span class="kds-time-elapsed">{{calcularTempoDecorrido(pedido)}}min</span>
                        </div>
                        <div class="kds-card-actions">
                            <button class="kds-action-btn btn-green" 
                                    ng-click="atualizarStatus(pedido, 'pronto')"
                                    title="Marcar como Pronto">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="kds-action-btn btn-red" 
                                    ng-click="cancelarPedido(pedido)"
                                    title="Cancelar">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coluna: Prontos -->
        <div class="kds-column">
            <div class="kds-column-header">
                <span>
                    <i class="fas fa-check-circle"></i>
                    Prontos
                </span>
                <span class="count-badge">{{getPedidosPorStatus('pronto').length}}</span>
            </div>
            <div class="kds-column-content">
                <div class="kds-order-card status-pronto" 
                     ng-repeat="pedido in getPedidosPorStatus('pronto') track by pedido._id"
                     ng-class="{'urgent': isUrgent(pedido)}">
                    
                    <!-- Header do card -->
                    <div class="kds-card-header">
                        <div class="kds-order-number">{{pedido.numero}}</div>
                        <div class="kds-order-type" ng-class="pedido.tipo">
                            <i class="fas" ng-class="getTypeIcon(pedido.tipo)"></i>
                            {{pedido.tipo | tipoText}}
                        </div>
                    </div>
                    
                    <!-- Canal -->
                    <div class="mb-2">
                        <span class="kds-channel-badge" ng-class="pedido.canal">
                            {{pedido.canal | canalText}}
                        </span>
                    </div>
                    
                    <!-- Informações do cliente -->
                    <div class="kds-customer-info">
                        <div class="kds-customer-name">{{pedido.cliente.nome}}</div>
                        <div class="kds-customer-phone" ng-if="pedido.cliente.telefone">
                            <i class="fas fa-phone"></i> {{pedido.cliente.telefone}}
                        </div>
                        <div class="kds-customer-address" ng-if="pedido.tipo === 'entrega' && pedido.cliente.endereco">
                            <i class="fas fa-map-marker-alt"></i>
                            {{pedido.cliente.endereco.rua}}, {{pedido.cliente.endereco.numero}} - {{pedido.cliente.endereco.bairro}}
                        </div>
                    </div>
                    
                    <!-- Itens do pedido -->
                    <div class="kds-order-items">
                        <div class="kds-order-item" ng-repeat="item in pedido.itens">
                            <div class="kds-item-name">
                                {{item.quantidade}}x {{item.produto.nome || item.produto_nome}} ({{item.tamanho}})
                            </div>
                            <div class="kds-item-details" ng-if="item.sabores.length > 0">
                                {{item.sabores.join(', ')}}
                            </div>
                            <div class="kds-item-details" ng-if="item.observacoes">
                                <i class="fas fa-comment"></i> {{item.observacoes}}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer do card -->
                    <div class="kds-card-footer">
                        <div class="kds-time-info">
                            <span><i class="fas fa-clock"></i> {{formatarTempo(calcularTempoDecorrido(pedido))}}</span>
                            <span class="kds-time-elapsed">{{calcularTempoDecorrido(pedido)}}min</span>
                        </div>
                        <div class="kds-card-actions">
                            <button class="kds-action-btn btn-blue" 
                                    ng-click="atualizarStatus(pedido, 'despachado')"
                                    title="Despachar">
                                <i class="fas fa-shipping-fast"></i>
                            </button>
                            <button class="kds-action-btn btn-green" 
                                    ng-click="atualizarStatus(pedido, 'entregue')"
                                    title="Marcar como Entregue"
                                    ng-if="pedido.tipo === 'retirada'">
                                <i class="fas fa-handshake"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coluna: Agendados -->
        <div class="kds-column">
            <div class="kds-column-header">
                <span>
                    <i class="fas fa-calendar-alt"></i>
                    Agendados
                </span>
                <span class="count-badge">{{getPedidosAgendados().length}}</span>
            </div>
            <div class="kds-column-content">
                <div class="kds-order-card status-agendado" 
                     ng-repeat="pedido in getPedidosAgendados() track by pedido._id">
                    
                    <!-- Header do card -->
                    <div class="kds-card-header">
                        <div class="kds-order-number">{{pedido.numero}}</div>
                        <div class="kds-order-type" ng-class="pedido.tipo">
                            <i class="fas" ng-class="getTypeIcon(pedido.tipo)"></i>
                            {{pedido.tipo | tipoText}}
                        </div>
                    </div>
                    
                    <!-- Horário agendado -->
                    <div class="mb-2">
                        <span class="badge bg-primary">
                            <i class="fas fa-clock"></i>
                            {{pedido.horario_agendado | date:'HH:mm'}}
                        </span>
                    </div>
                    
                    <!-- Canal -->
                    <div class="mb-2">
                        <span class="kds-channel-badge" ng-class="pedido.canal">
                            {{pedido.canal | canalText}}
                        </span>
                    </div>
                    
                    <!-- Informações do cliente -->
                    <div class="kds-customer-info">
                        <div class="kds-customer-name">{{pedido.cliente.nome}}</div>
                        <div class="kds-customer-phone" ng-if="pedido.cliente.telefone">
                            <i class="fas fa-phone"></i> {{pedido.cliente.telefone}}
                        </div>
                        <div class="kds-customer-address" ng-if="pedido.tipo === 'entrega' && pedido.cliente.endereco">
                            <i class="fas fa-map-marker-alt"></i>
                            {{pedido.cliente.endereco.rua}}, {{pedido.cliente.endereco.numero}} - {{pedido.cliente.endereco.bairro}}
                        </div>
                    </div>
                    
                    <!-- Itens do pedido -->
                    <div class="kds-order-items">
                        <div class="kds-order-item" ng-repeat="item in pedido.itens">
                            <div class="kds-item-name">
                                {{item.quantidade}}x {{item.produto.nome || item.produto_nome}} ({{item.tamanho}})
                            </div>
                            <div class="kds-item-details" ng-if="item.sabores.length > 0">
                                {{item.sabores.join(', ')}}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer do card -->
                    <div class="kds-card-footer">
                        <div class="kds-time-info">
                            <span><i class="fas fa-calendar"></i> Agendado</span>
                        </div>
                        <div class="kds-card-actions">
                            <button class="kds-action-btn btn-green" 
                                    ng-click="iniciarPedidoAgendado(pedido)"
                                    title="Iniciar Agora">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer do KDS -->
    <div class="kds-footer">
        <div class="kds-footer-left">
            <button class="kds-footer-btn">
                <i class="fas fa-exclamation-triangle"></i>
                Retirada: Não configurado
            </button>
            <button class="kds-footer-btn">
                <i class="fas fa-clock"></i>
                Ajustar tempo de entrega
            </button>
        </div>
        <div class="kds-footer-right">
            <button class="kds-footer-btn" ng-click="atualizarPedidos()">
                <i class="fas fa-sync-alt"></i>
                Atualizar
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular-route.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <!-- App Scripts -->
    <script src="js/app.js"></script>
    <script src="js/services/apiService.js"></script>
    <script src="js/services/socketService.js"></script>
    <script src="js/services/authService.js"></script>
    <script src="js/controllers/kdsController.js"></script>

</body>
</html>

