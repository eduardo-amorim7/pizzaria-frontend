<div class="kds-layout" ng-controller="KdsController">
  <!-- Header do KDS -->
  <div class="kds-header">
    <div class="header-left">
      <div class="menu-toggle">
        <span class="hamburger">☰</span>
      </div>
      <div class="tab-pedidos active">
        <span class="tab-icon">📋</span>
        <span class="tab-text">Pedidos</span>
        <button class="tab-close">×</button>
      </div>
      <div class="search-container">
        <input type="text" placeholder="Procurar..." class="search-input">
      </div>
    </div>

    <div class="header-center">
      <div class="filter-buttons">
        <button class="filter-btn" ng-class="{'active': filtros.entrega}" ng-click="alternarFiltro('entrega')">
          <span class="filter-icon">🏍️</span> Entrega
        </button>
        <button class="filter-btn" ng-class="{'active': filtros.retirada}" ng-click="alternarFiltro('retirada')">
          <span class="filter-icon">🚶</span> Retirada
        </button>
        <button class="filter-btn" ng-class="{'active': filtros.balcao}" ng-click="alternarFiltro('balcao')">
          <span class="filter-icon">🍽️</span> Balcão
        </button>
        <button class="filter-btn" ng-class="{'active': filtros.mesa}" ng-click="alternarFiltro('mesa')">
          <span class="filter-icon">🪑</span> Mesa
        </button>
      </div>
    </div>

    <div class="header-right">
      <div class="action-buttons">
        <button class="action-btn site-aberto" ng-class="{'active': configuracoes.siteAberto}" ng-click="alternarConfiguracao('siteAberto')">
          <span class="btn-icon">🌐</span> Site Aberto
        </button>
        <button class="action-btn caixa-aberto" ng-class="{'active': configuracoes.caixaAberto}" ng-click="alternarConfiguracao('caixaAberto')">
          <span class="btn-icon">💰</span> Caixa Aberto
        </button>
        <button class="action-btn caixa-detalhado" ng-class="{'active': configuracoes.caixaDetalhado}" ng-click="alternarConfiguracao('caixaDetalhado')">
          <span class="btn-icon">📊</span> Caixa Detalhado
        </button>
        <button class="action-btn novo-pedido" ng-click="abrirNovoPedido()">
          <span class="btn-icon">➕</span> Novo Pedido
        </button>
      </div>
      <div class="clock">
        <span class="clock-icon">🕐</span>
        <span class="clock-time">{{currentTime | date:'HH:mm'}}</span>
      </div>
      <div class="user-menu">
        <span class="user-icon">👤</span>
      </div>
    </div>
  </div>

  <!-- Colunas do KDS -->
  <div class="kds-columns">
    <!-- Coluna Novos -->
    <div class="kds-column column-novos">
      <div class="column-header">
        <span class="column-icon">🆕</span>
        <span class="column-title">Novos</span>
        <span class="column-count">{{pedidos.novos.length}}</span>
      </div>
      <div class="column-content">
        <div class="pedido-card" 
             ng-repeat="pedido in pedidos.novos | filter:pedidoVisivel" 
             ng-class="{'atrasado': estaAtrasado(pedido)}"
             ng-click="abrirAcoesPedido(pedido)">
          <div class="card-header">
            <div class="pedido-numero">{{pedido.numero}}</div>
            <div class="pedido-badges">
              <span class="badge" ng-class="getClasseCanal(pedido.canal)">{{pedido.canal.toUpperCase()}}</span>
              <span class="tipo-badge">{{getIconeTipo(pedido.tipo)}} {{pedido.tipo}}</span>
            </div>
          </div>
          <div class="card-body">
            <div class="cliente-info">
              <div class="cliente-nome">{{pedido.cliente.nome}}</div>
              <div class="cliente-contato">{{pedido.cliente.telefone}}</div>
              <div class="cliente-endereco" ng-if="pedido.tipo === 'entrega'">{{pedido.cliente.endereco}}</div>
            </div>
            <div class="itens-resumo">
              <div class="item" ng-repeat="item in pedido.itens">
                <span class="item-qtd">{{item.quantidade}}x</span>
                <span class="item-nome">{{item.produto.nome}}</span>
                <div class="item-sabores" ng-if="item.sabores.length > 0">
                  <span ng-repeat="sabor in item.sabores">{{sabor}}<span ng-if="!$last">, </span></span>
                </div>
                <div class="item-observacoes" ng-if="item.observacoes">{{item.observacoes}}</div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <div class="tempo-decorrido">
              <span class="tempo-icon">⏱️</span>
              <span class="tempo-valor">{{calcularTempo(pedido.data_criacao)}}</span>
            </div>
            <div class="card-actions">
              <button class="action-icon success" ng-click="$event.stopPropagation(); alterarStatus(pedido, 'em_preparo')" title="Iniciar Preparo">✓</button>
              <button class="action-icon danger" ng-click="$event.stopPropagation(); cancelarPedido(pedido)" title="Cancelar">✗</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Coluna Processando -->
    <div class="kds-column column-processando">
      <div class="column-header">
        <span class="column-icon">⚙️</span>
        <span class="column-title">Processando</span>
        <span class="column-count">{{pedidos.processando.length}}</span>
      </div>
      <div class="column-content">
        <div class="pedido-card" 
             ng-repeat="pedido in pedidos.processando | filter:pedidoVisivel" 
             ng-class="{'atrasado': estaAtrasado(pedido)}"
             ng-click="abrirAcoesPedido(pedido)">
          <div class="card-header">
            <div class="pedido-numero">{{pedido.numero}}</div>
            <div class="pedido-badges">
              <span class="badge" ng-class="getClasseCanal(pedido.canal)">{{pedido.canal.toUpperCase()}}</span>
              <span class="tipo-badge">{{getIconeTipo(pedido.tipo)}} {{pedido.tipo}}</span>
            </div>
          </div>
          <div class="card-body">
            <div class="cliente-info">
              <div class="cliente-nome">{{pedido.cliente.nome}}</div>
              <div class="cliente-contato">{{pedido.cliente.telefone}}</div>
              <div class="cliente-endereco" ng-if="pedido.tipo === 'entrega'">{{pedido.cliente.endereco}}</div>
            </div>
            <div class="itens-resumo">
              <div class="item" ng-repeat="item in pedido.itens">
                <span class="item-qtd">{{item.quantidade}}x</span>
                <span class="item-nome">{{item.produto.nome}}</span>
                <div class="item-sabores" ng-if="item.sabores.length > 0">
                  <span ng-repeat="sabor in item.sabores">{{sabor}}<span ng-if="!$last">, </span></span>
                </div>
                <div class="item-observacoes" ng-if="item.observacoes">{{item.observacoes}}</div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <div class="tempo-decorrido">
              <span class="tempo-icon">⏱️</span>
              <span class="tempo-valor">{{calcularTempo(pedido.data_criacao)}}</span>
            </div>
            <div class="card-actions">
              <button class="action-icon success" ng-click="$event.stopPropagation(); alterarStatus(pedido, 'pronto')" title="Marcar como Pronto">✓</button>
              <button class="action-icon danger" ng-click="$event.stopPropagation(); cancelarPedido(pedido)" title="Cancelar">✗</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Coluna Prontos -->
    <div class="kds-column column-prontos">
      <div class="column-header">
        <span class="column-icon">✅</span>
        <span class="column-title">Prontos</span>
        <span class="column-count">{{pedidos.prontos.length}}</span>
      </div>
      <div class="column-content">
        <div class="pedido-card" 
             ng-repeat="pedido in pedidos.prontos | filter:pedidoVisivel" 
             ng-class="{'atrasado': estaAtrasado(pedido)}"
             ng-click="abrirAcoesPedido(pedido)">
          <div class="card-header">
            <div class="pedido-numero">{{pedido.numero}}</div>
            <div class="pedido-badges">
              <span class="badge" ng-class="getClasseCanal(pedido.canal)">{{pedido.canal.toUpperCase()}}</span>
              <span class="tipo-badge">{{getIconeTipo(pedido.tipo)}} {{pedido.tipo}}</span>
            </div>
          </div>
          <div class="card-body">
            <div class="cliente-info">
              <div class="cliente-nome">{{pedido.cliente.nome}}</div>
              <div class="cliente-contato">{{pedido.cliente.telefone}}</div>
              <div class="cliente-endereco" ng-if="pedido.tipo === 'entrega'">{{pedido.cliente.endereco}}</div>
            </div>
            <div class="itens-resumo">
              <div class="item" ng-repeat="item in pedido.itens">
                <span class="item-qtd">{{item.quantidade}}x</span>
                <span class="item-nome">{{item.produto.nome}}</span>
                <div class="item-sabores" ng-if="item.sabores.length > 0">
                  <span ng-repeat="sabor in item.sabores">{{sabor}}<span ng-if="!$last">, </span></span>
                </div>
                <div class="item-observacoes" ng-if="item.observacoes">{{item.observacoes}}</div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <div class="tempo-decorrido">
              <span class="tempo-icon">⏱️</span>
              <span class="tempo-valor">{{calcularTempo(pedido.data_criacao)}}</span>
            </div>
            <div class="card-actions">
              <button class="action-icon primary" ng-click="$event.stopPropagation(); alterarStatus(pedido, 'despachado')" title="Despachar">🚀</button>
              <button class="action-icon info" ng-click="$event.stopPropagation(); abrirDetalhePedido(pedido)" title="Ver Detalhes">ℹ️</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Coluna Agendados -->
    <div class="kds-column column-agendados">
      <div class="column-header">
        <span class="column-icon">📅</span>
        <span class="column-title">Agendados</span>
        <span class="column-count">{{pedidos.agendados.length}}</span>
      </div>
      <div class="column-content">
        <div class="pedido-card" 
             ng-repeat="pedido in pedidos.agendados | filter:pedidoVisivel"
             ng-click="abrirAcoesPedido(pedido)">
          <div class="card-header">
            <div class="pedido-numero">{{pedido.numero}}</div>
            <div class="pedido-badges">
              <span class="badge" ng-class="getClasseCanal(pedido.canal)">{{pedido.canal.toUpperCase()}}</span>
              <span class="tipo-badge">{{getIconeTipo(pedido.tipo)}} {{pedido.tipo}}</span>
            </div>
          </div>
          <div class="card-body">
            <div class="cliente-info">
              <div class="cliente-nome">{{pedido.cliente.nome}}</div>
              <div class="cliente-contato">{{pedido.cliente.telefone}}</div>
              <div class="cliente-endereco" ng-if="pedido.tipo === 'entrega'">{{pedido.cliente.endereco}}</div>
            </div>
            <div class="agendamento-info">
              <div class="agendamento-data">
                <span class="agendamento-icon">📅</span>
                <span class="agendamento-valor">{{pedido.data_agendamento | date:'dd/MM HH:mm'}}</span>
              </div>
            </div>
            <div class="itens-resumo">
              <div class="item" ng-repeat="item in pedido.itens">
                <span class="item-qtd">{{item.quantidade}}x</span>
                <span class="item-nome">{{item.produto.nome}}</span>
                <div class="item-sabores" ng-if="item.sabores.length > 0">
                  <span ng-repeat="sabor in item.sabores">{{sabor}}<span ng-if="!$last">, </span></span>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <div class="card-actions">
              <button class="action-icon success" ng-click="$event.stopPropagation(); alterarStatus(pedido, 'aguardando_preparo')" title="Mover para Novos">▶️</button>
              <button class="action-icon info" ng-click="$event.stopPropagation(); abrirDetalhePedido(pedido)" title="Ver Detalhes">ℹ️</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer do KDS -->
  <div class="kds-footer">
    <div class="footer-left">
      <button class="footer-btn" ng-class="{'warning': !configuracoes.retiradaConfigurada}">
        <span class="btn-icon">⚠️</span>
        <span class="btn-text">Retirada: {{configuracoes.retiradaConfigurada ? 'Configurado' : 'Não configurado'}}</span>
      </button>
      <button class="footer-btn">
        <span class="btn-icon">🚚</span>
        <span class="btn-text">Ajustar tempo de entrega</span>
      </button>
    </div>
    <div class="footer-right">
      <button class="footer-btn atualizar" ng-click="carregarPedidos()">
        <span class="btn-icon">🔄</span>
        <span class="btn-text">Atualizar</span>
      </button>
    </div>
  </div>

  <!-- Incluir os modais -->
  <div ng-include="'views/modals.html'"></div>
</div>

