<!-- Modal de Ações do Pedido -->
<div class="pedido-modal-content" ng-if="pedidoSelecionado">
    
    <!-- Informações do Pedido -->
    <div class="pedido-info-section">
        <div class="row">
            <div class="col-md-6">
                <div class="info-card">
                    <h6><i class="fas fa-info-circle"></i> Informações do Pedido</h6>
                    <div class="info-item">
                        <strong>Número:</strong> #{{pedidoSelecionado.numero}}
                    </div>
                    <div class="info-item">
                        <strong>Status:</strong> 
                        <span class="badge" ng-class="'badge-' + pedidoSelecionado.status">
                            {{pedidoSelecionado.status | statusText}}
                        </span>
                    </div>
                    <div class="info-item">
                        <strong>Tipo:</strong> {{pedidoSelecionado.tipo | tipoText}}
                    </div>
                    <div class="info-item">
                        <strong>Canal:</strong> {{pedidoSelecionado.canal | canalText}}
                    </div>
                    <div class="info-item">
                        <strong>Total:</strong> {{pedidoSelecionado.total | formatMoeda}}
                    </div>
                    <div class="info-item">
                        <strong>Criado em:</strong> {{pedidoSelecionado.data_criacao | date:'dd/MM/yyyy HH:mm'}}
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="info-card">
                    <h6><i class="fas fa-user"></i> Cliente</h6>
                    <div class="info-item">
                        <strong>Nome:</strong> {{pedidoSelecionado.cliente.nome}}
                    </div>
                    <div class="info-item" ng-if="pedidoSelecionado.cliente.telefone">
                        <strong>Telefone:</strong> 
                        <a href="tel:{{pedidoSelecionado.cliente.telefone}}">
                            {{pedidoSelecionado.cliente.telefone}}
                        </a>
                    </div>
                    <div class="info-item" ng-if="pedidoSelecionado.tipo === 'entrega' && pedidoSelecionado.cliente.endereco">
                        <strong>Endereço:</strong><br>
                        {{pedidoSelecionado.cliente.endereco.rua}}, {{pedidoSelecionado.cliente.endereco.numero}}<br>
                        {{pedidoSelecionado.cliente.endereco.bairro}} - {{pedidoSelecionado.cliente.endereco.cidade}}
                        <span ng-if="pedidoSelecionado.cliente.endereco.cep">- CEP: {{pedidoSelecionado.cliente.endereco.cep}}</span>
                    </div>
                    <div class="info-item" ng-if="pedidoSelecionado.cliente.endereco.complemento">
                        <strong>Complemento:</strong> {{pedidoSelecionado.cliente.endereco.complemento}}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Itens do Pedido -->
    <div class="pedido-items-section">
        <div class="info-card">
            <h6><i class="fas fa-list"></i> Itens do Pedido</h6>
            <div class="items-list">
                <div class="item-row" ng-repeat="item in pedidoSelecionado.itens">
                    <div class="item-info">
                        <div class="item-name">
                            <strong>{{item.quantidade}}x {{item.produto.nome || item.produto_nome}}</strong>
                            <span class="item-size">({{item.tamanho}})</span>
                        </div>
                        <div class="item-details" ng-if="item.sabores.length > 0">
                            <i class="fas fa-pizza-slice"></i>
                            <strong>Sabores:</strong> {{item.sabores.join(', ')}}
                        </div>
                        <div class="item-details" ng-if="item.borda">
                            <i class="fas fa-circle"></i>
                            <strong>Borda:</strong> {{item.borda}}
                        </div>
                        <div class="item-details" ng-if="item.adicionais && item.adicionais.length > 0">
                            <i class="fas fa-plus"></i>
                            <strong>Adicionais:</strong> {{item.adicionais.join(', ')}}
                        </div>
                        <div class="item-details" ng-if="item.observacoes">
                            <i class="fas fa-comment"></i>
                            <strong>Observações:</strong> {{item.observacoes}}
                        </div>
                    </div>
                    <div class="item-price">
                        {{item.preco_unitario | formatMoeda}}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Observações Gerais -->
    <div class="pedido-observacoes-section" ng-if="pedidoSelecionado.observacoes">
        <div class="info-card">
            <h6><i class="fas fa-sticky-note"></i> Observações Gerais</h6>
            <p>{{pedidoSelecionado.observacoes}}</p>
        </div>
    </div>

    <!-- Tempo e Status -->
    <div class="pedido-tempo-section">
        <div class="info-card">
            <h6><i class="fas fa-clock"></i> Tempo e Status</h6>
            <div class="row">
                <div class="col-md-4">
                    <div class="tempo-info">
                        <strong>Tempo Decorrido:</strong><br>
                        <span class="tempo-valor">{{calcularTempoDecorrido(pedidoSelecionado)}} minutos</span>
                    </div>
                </div>
                <div class="col-md-4" ng-if="pedidoSelecionado.tempo_preparo">
                    <div class="tempo-info">
                        <strong>Tempo de Preparo:</strong><br>
                        <span class="tempo-valor">{{pedidoSelecionado.tempo_preparo}} minutos</span>
                    </div>
                </div>
                <div class="col-md-4" ng-if="pedidoSelecionado.tempo_entrega">
                    <div class="tempo-info">
                        <strong>Tempo de Entrega:</strong><br>
                        <span class="tempo-valor">{{pedidoSelecionado.tempo_entrega}} minutos</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ações do Pedido -->
    <div class="pedido-acoes-section">
        <div class="info-card">
            <h6><i class="fas fa-cogs"></i> Ações Disponíveis</h6>
            
            <!-- Ações baseadas no status atual -->
            <div class="acoes-grid">
                
                <!-- Status: Aguardando Preparo -->
                <div ng-if="pedidoSelecionado.status === 'aguardando_preparo'">
                    <button class="btn btn-success btn-acao" ng-click="atualizarStatusModal('em_preparo')">
                        <i class="fas fa-play"></i>
                        Iniciar Preparo
                    </button>
                    <button class="btn btn-warning btn-acao" ng-click="editarPedido()">
                        <i class="fas fa-edit"></i>
                        Editar Pedido
                    </button>
                    <button class="btn btn-danger btn-acao" ng-click="cancelarPedidoModal()">
                        <i class="fas fa-times"></i>
                        Cancelar Pedido
                    </button>
                </div>

                <!-- Status: Em Preparo -->
                <div ng-if="pedidoSelecionado.status === 'em_preparo'">
                    <button class="btn btn-success btn-acao" ng-click="atualizarStatusModal('pronto')">
                        <i class="fas fa-check"></i>
                        Marcar como Pronto
                    </button>
                    <button class="btn btn-info btn-acao" ng-click="pausarPedido()">
                        <i class="fas fa-pause"></i>
                        Pausar Preparo
                    </button>
                    <button class="btn btn-danger btn-acao" ng-click="cancelarPedidoModal()">
                        <i class="fas fa-times"></i>
                        Cancelar Pedido
                    </button>
                </div>

                <!-- Status: Pronto -->
                <div ng-if="pedidoSelecionado.status === 'pronto'">
                    <button class="btn btn-primary btn-acao" ng-click="atualizarStatusModal('despachado')" ng-if="pedidoSelecionado.tipo === 'entrega'">
                        <i class="fas fa-shipping-fast"></i>
                        Despachar para Entrega
                    </button>
                    <button class="btn btn-success btn-acao" ng-click="atualizarStatusModal('entregue')" ng-if="pedidoSelecionado.tipo === 'retirada'">
                        <i class="fas fa-handshake"></i>
                        Marcar como Retirado
                    </button>
                    <button class="btn btn-success btn-acao" ng-click="atualizarStatusModal('entregue')" ng-if="pedidoSelecionado.tipo === 'consumo_local'">
                        <i class="fas fa-utensils"></i>
                        Marcar como Servido
                    </button>
                    <button class="btn btn-warning btn-acao" ng-click="voltarStatus('em_preparo')">
                        <i class="fas fa-undo"></i>
                        Voltar ao Preparo
                    </button>
                </div>

                <!-- Status: Despachado -->
                <div ng-if="pedidoSelecionado.status === 'despachado'">
                    <button class="btn btn-success btn-acao" ng-click="atualizarStatusModal('entregue')">
                        <i class="fas fa-check-circle"></i>
                        Confirmar Entrega
                    </button>
                    <button class="btn btn-warning btn-acao" ng-click="voltarStatus('pronto')">
                        <i class="fas fa-undo"></i>
                        Voltar para Pronto
                    </button>
                </div>

                <!-- Ações Gerais (disponíveis para todos os status) -->
                <div class="acoes-gerais">
                    <button class="btn btn-info btn-acao" ng-click="imprimirComanda()">
                        <i class="fas fa-print"></i>
                        Imprimir Comanda
                    </button>
                    <button class="btn btn-secondary btn-acao" ng-click="duplicarPedido()">
                        <i class="fas fa-copy"></i>
                        Duplicar Pedido
                    </button>
                    <button class="btn btn-dark btn-acao" ng-click="verHistorico()">
                        <i class="fas fa-history"></i>
                        Ver Histórico
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Histórico de Status (se solicitado) -->
    <div class="pedido-historico-section" ng-if="mostrarHistorico">
        <div class="info-card">
            <h6><i class="fas fa-history"></i> Histórico do Pedido</h6>
            <div class="historico-timeline">
                <div class="timeline-item" ng-repeat="evento in pedidoSelecionado.historico">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div class="timeline-time">{{evento.data | date:'dd/MM/yyyy HH:mm:ss'}}</div>
                        <div class="timeline-event">{{evento.descricao}}</div>
                        <div class="timeline-user" ng-if="evento.usuario">por {{evento.usuario}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- CSS específico para o modal de ações -->
<style>
.pedido-modal-content {
    max-height: 70vh;
    overflow-y: auto;
}

.pedido-info-section,
.pedido-items-section,
.pedido-observacoes-section,
.pedido-tempo-section,
.pedido-acoes-section,
.pedido-historico-section {
    margin-bottom: 1.5rem;
}

.info-card {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.info-card h6 {
    margin-bottom: 1rem;
    color: #495057;
    font-weight: 600;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 0.5rem;
}

.info-item {
    margin-bottom: 0.5rem;
    line-height: 1.4;
}

.info-item strong {
    color: #495057;
}

.badge-aguardando_preparo {
    background-color: #ffc107;
    color: #000;
}

.badge-em_preparo {
    background-color: #fd7e14;
    color: #fff;
}

.badge-pronto {
    background-color: #28a745;
    color: #fff;
}

.badge-despachado {
    background-color: #007bff;
    color: #fff;
}

.badge-entregue {
    background-color: #6c757d;
    color: #fff;
}

.badge-cancelado {
    background-color: #dc3545;
    color: #fff;
}

.items-list {
    max-height: 200px;
    overflow-y: auto;
}

.item-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 0.75rem;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    background: white;
}

.item-info {
    flex: 1;
}

.item-name {
    font-size: 1rem;
    margin-bottom: 0.5rem;
}

.item-size {
    color: #6c757d;
    font-weight: normal;
}

.item-details {
    font-size: 0.875rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.item-details i {
    width: 16px;
    margin-right: 0.5rem;
}

.item-price {
    font-weight: 600;
    color: #28a745;
    font-size: 1rem;
}

.tempo-info {
    text-align: center;
    padding: 0.5rem;
    background: white;
    border-radius: 6px;
    border: 1px solid #e9ecef;
}

.tempo-valor {
    font-size: 1.25rem;
    font-weight: 600;
    color: #007bff;
}

.acoes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.75rem;
}

.btn-acao {
    width: 100%;
    padding: 0.75rem;
    font-weight: 500;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.btn-acao:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.acoes-gerais {
    grid-column: 1 / -1;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.5rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #dee2e6;
}

.historico-timeline {
    max-height: 200px;
    overflow-y: auto;
}

.timeline-item {
    display: flex;
    margin-bottom: 1rem;
    position: relative;
}

.timeline-marker {
    width: 12px;
    height: 12px;
    background: #007bff;
    border-radius: 50%;
    margin-right: 1rem;
    margin-top: 0.25rem;
    flex-shrink: 0;
}

.timeline-content {
    flex: 1;
}

.timeline-time {
    font-size: 0.875rem;
    color: #6c757d;
    font-weight: 500;
}

.timeline-event {
    font-weight: 500;
    margin: 0.25rem 0;
}

.timeline-user {
    font-size: 0.875rem;
    color: #6c757d;
    font-style: italic;
}

@media (max-width: 768px) {
    .acoes-grid {
        grid-template-columns: 1fr;
    }
    
    .acoes-gerais {
        grid-template-columns: 1fr;
    }
}
</style>

